package Polynomial;

import java.util.Vector;
import java.util.regex.Matcher;
import java.util.regex.Pattern;

public class Polynomial {
	Vector<Integer> coeffs = new Vector<Integer>(10);
	Vector<Character> signs = new Vector<Character>();
	
	public Polynomial() {}
	public Polynomial(String str) {
		this.coeffs = fromString(str);
	}
	
	
	public void add(int coeff, int power) {
		while(power > this.coeffs.size() - 1) {
			this.coeffs.insertElementAt(0, 0);;
		}
		this.coeffs.setElementAt(coeff, power);
	}
	
	public void addSign(char sign) {
		signs.add(sign);
	}
	
	public Polynomial sum (Polynomial lhs, Polynomial rhs) {
		Polynomial result = new Polynomial();
		int size = lhs.coeffs.size() > rhs.coeffs.size() ? lhs.coeffs.size() : rhs.coeffs.size();
		for(int i = size - 1; i > -1 ; i--) {
			if (i+1 > lhs.coeffs.size()) {
				result.add(rhs.coeffs.elementAt(i), i);
			}
			else if (i+1 > rhs.coeffs.size()) {
				result.add(lhs.coeffs.elementAt(i), i);
			}
			else {
				int tempEl = lhs.coeffs.elementAt(i) + rhs.coeffs.elementAt(i);
				result.add(tempEl, i);
			}

		}
		return result;
	}
	
	public Polynomial substract (Polynomial lhs, Polynomial rhs) {
		Polynomial result = new Polynomial();
		int size = lhs.coeffs.size() > rhs.coeffs.size() ? lhs.coeffs.size() : rhs.coeffs.size();
		for(int i = size - 1; i > -1 ; i--) {
			if (i+1 > lhs.coeffs.size()) {
				result.add(rhs.coeffs.elementAt(i), i);
			}
			else if (i+1 > rhs.coeffs.size()) {
				result.add(lhs.coeffs.elementAt(i), i);
			}
			else {
				int tempEl = lhs.coeffs.elementAt(i) - rhs.coeffs.elementAt(i);
				result.add(tempEl, i);
			}

		}
		return result;
	}
	
	public Polynomial multiply (Polynomial lhs, Polynomial rhs) {
		Polynomial result = new Polynomial();
		int size = lhs.coeffs.size() > rhs.coeffs.size() ? lhs.coeffs.size() : rhs.coeffs.size();
		for(int i = size - 1; i > -1 ; i--) {
			if (i+1 > lhs.coeffs.size()) {
				result.add(rhs.coeffs.elementAt(i), i);
			}
			else if (i+1 > rhs.coeffs.size()) {
				result.add(lhs.coeffs.elementAt(i), i);
			}
			else {
				int tempEl = lhs.coeffs.elementAt(i) * rhs.coeffs.elementAt(i);
				result.add(tempEl, i);
			}

		}
		return result;
	}
	
	public Polynomial multiplyNumber (Polynomial lhs, int number) {
		Polynomial result = new Polynomial();
		for(int i = lhs.coeffs.size() - 1; i > -1 ; i--) {
			int tempEl = lhs.coeffs.elementAt(i) * number;
			result.add(tempEl, i);
		}
		return result;
	}
	
	public Polynomial derivative (Polynomial lhs) {
		Polynomial result = new Polynomial();
		for(int i = lhs.coeffs.size() - 1; i > 0 ; i--) {
			result.add(lhs.coeffs.elementAt(i) * i, i - 1);
		}
		return result;
	}
	
	public int evaluate (int valueOfX) {
		int result = 0;
		Vector<Integer> elemets = new Vector<Integer>();
		for(int i = 0; i < this.coeffs.size() ; i++) {
			if (this.coeffs.elementAt(i) != 0) {
				int temp = (int)Math.pow((double)valueOfX, (double)i);
				temp *= this.coeffs.elementAt(i);
				elemets.insertElementAt(temp, 0);
			}
		}
		result += elemets.elementAt(0);
		for (int j = 0; j < this.signs.size(); j++) {
			char sign = this.signs.elementAt(j);
			switch(sign) {
				case '+': result += elemets.elementAt(j + 1);
				break;
				case '-': result -= elemets.elementAt(j + 1);
				break;
			}
			
		}
		return result;
	}
	
	public static int[] coeffPower(String str) {
		int [] result = new int [2];
		if(str.contains("x^")) {
			String[] coeffPower = str.split("x\\^");
			result[0] = Integer.parseInt(coeffPower[0]);
			result[1] = Integer.parseInt(coeffPower[1]);
		}
		else if(str.contains("x")) {
			result[0] = Integer.parseInt(str.substring(0, str.length() - 1));
			result[1] = 1;
		}
		else {
			result[0] = Integer.parseInt(str);
			result[1] = 0;
		}
		return result;
	}
	
	public static void fromString(String pol) {
		Vector<Integer> result = new Vector<Integer>(10);
		String pattern = "(-?\\d+x?(\\^\\d+)?)";
		Pattern p = Pattern.compile(pattern);
		Matcher m = p.matcher(pol);

        while(m.find()) {
        	int[] temp = coeffPower(m.group());
        	result.add(temp[0], temp[1]);
        }
	}
	
	public String toString() {
		String result = "";
		for(int i = coeffs.size() - 1; i > -1; i--) {
/*			if (coeffs.elementAt(i) != 0){*/
				result += coeffs.elementAt(i) + "x^" + i + " ";
		}
		return result;
	}
}
